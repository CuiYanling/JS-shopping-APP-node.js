<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>我的资料</title>
    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">
    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="assets/i/pic_logo.png">
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="assets/i/app-icon72x72@2x.png">
    <meta name="msapplication-TileColor" content="#0e90d2">
    <link rel="stylesheet" href="assets/css/amazeui.min.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/search.css" />
    <link rel="stylesheet" type="text/css" href="css/detail.css" />
    <link rel="stylesheet" type="text/css" href="css/wode.css" />
    <link rel="stylesheet" type="text/css" href="css/ziliao.css" />
    <link rel="stylesheet" type="text/css" href="css/xiangz.css" />
</head>

<body>
    <!--header-->
    <div class="header am-g" data-am-sticky>
        <div class="am-u-sm-2 header_pic">
            <a href="ziliao.html">
                <span class="am-icon-angle-left">
                </span>
            </a>
        </div>
        <div class="header1 am-u-sm-8">
            我的资料
        </div>
        <div class="header2 am-u-sm-2" id="bj">
            编辑
        </div>
    </div>
    <div class="" style="margin-top: 1rem;">
    </div>
    <div class="tips-box" id="tips">
        <span></span>
    </div>
    <div class="tilt1" id="infoBox">
    </div>
    <div class="tilt2" id="infoBox2">
        <!--姓名-->
        <form action="#" class="" id="form2" method="post">
            <div class="zd2">
                <div class="am-g padd">
                    <div class="am-u-sm-4 zl_t">
                        <span class="zl_te1">
                            姓名
                        </span>
                    </div>
                    <div class="am-u-sm-8 am-text-right">
                        <input class="zl_te username" type="" name="username" id="" value="" nullmsg="姓名不能为空" errormsg="姓名为3至20个字符" datatype="*3-20|null" />
                    </div>
                </div>
            </div>
            <!--手机号-->
            <input type="hidden" name="tel" class="tel_my" value="">
            <!--邮箱-->
            <div class="zd2">
                <div class="am-g padd">
                    <div class="am-u-sm-4 zl_t">
                        <span class="zl_te1">
                            邮箱
                        </span>
                    </div>
                    <div class="am-u-sm-8 am-text-right">
                        <!--<span class="zl_te">
                    22******2@qq.com
                    </span>-->
                        <input class="zl_te useremail" type="text" name="email" id="" value="" placeholder="" datatype="e|null" nullmsg='邮箱号不能为空 ' errormsg="邮箱号格式错误" />
                        <!--<span class="text-yz">未验证</span>-->
                    </div>
                </div>
            </div>
            <!---->
            <div class="">
                <input type="submit" name="bj2" id="bj2" value="完成" />
            </div>
        </form>
    </div>
    <!--bottom-->
    <div class="botto am-cf" data-am-sticky>
        <div class="bott_pic am-text-center">
            <a href="index.html">
                <img src="https://cres.fenqile.cn/mobile/img/nav/list/consume.png" />
                <div class="bott_txt">
                    首页
                </div>
            </a>
        </div>
        <div class="bott_pic am-text-center">
            <a href="class.html">
                <img src="https://cres.fenqile.cn/mobile/img/nav/list/class.png" />
                <div class="bott_txt">
                    分类
                </div>
            </a>
        </div>
        <div class="bott_pic am-text-center">
            <a href="shopingcar.html">
                <img src="https://cres.fenqile.cn/mobile/img/nav/list/cart.png" />
                <div class="bott_txt">
                    购物车
                </div>
            </a>
        </div>
        <div class="bott_pic am-text-center">
            <a href="lecart.html">
                <img src="https://cres.fenqile.cn/mobile/img/nav/list/lecard.png" />
                <div class="bott_txt">
                    乐卡
                </div>
            </a>
        </div>
        <div class="bott_pic am-text-center">
            <a href="wode.html">
                <img src="https://cres.fenqile.cn/mobile/img/nav/list/mine_on.png" />
                <div class="bott_txt change4">
                    我的
                </div>
            </a>
        </div>
    </div>
</body>
<!--<script src="http://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>-->
<!--<script src="" type="text/javascript" charset="utf-8"></script>-->
<script src="js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/detail.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>-->
<script src="assets/js/amazeui.ie8polyfill.min.js"></script>
<script src="assets/js/amazeui.min.js"></script>
<!--<script src="js/index.js" type="text/javascript" charset="utf-8"></script>-->
<script src="js/Validform_v5.3.2.js" type="text/javascript" charset="utf-8"></script>
<script src="js/gVerify.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="js/template-web.js"></script>
<script type="text/html" id="tpl-user">
    <div class="zd2">
        <div class="am-g padd">
            <div class="am-u-sm-4 zl_t">
                <span class="zl_te1">
                    姓名
                </span>
            </div>
            <div class="am-u-sm-8 am-text-right">
                <span class="zl_te username">
                    {{nickname}}
                </span>
            </div>
        </div>
    </div>
    <!--学校-->
    <div class="zd2">
        <div class="am-g padd">
            <div class="am-u-sm-4 zl_t">
                <span class="zl_te1">
                    学校
                </span>
            </div>
            <div class="am-u-sm-8 am-text-right">
                <span class="zl_te">
                    {{school}}
                </span>
            </div>
        </div>
    </div>
    <!--院系-->
    <div class="zd2">
        <div class="am-g padd">
            <div class="am-u-sm-4 zl_t">
                <span class="zl_te1">
                    院系
                </span>
            </div>
            <div class="am-u-sm-8 am-text-right">
                <span class="zl_te">
                    {{department}}
                </span>
                <!--<a href="myaddress.html"><span class="am-icon-angle-right right2"></span></a>-->
            </div>
        </div>
    </div>
    <!--手机号-->
    <div class="zd2">
        <div class="am-g padd">
            <div class="am-u-sm-4 zl_t">
                <span class="zl_te1">
                    手机
                </span>
            </div>
            <div class="am-u-sm-8 am-text-right">
                <span class="zl_te usertel">
                    {{reg1_ph}}
                </span>
                <!--<a href="##"><span class="am-icon-angle-right right2"></span></a>-->
            </div>
        </div>
    </div>
    <!--邮箱-->
    <div class="zd2">
        <div class="am-g padd">
            <div class="am-u-sm-4 zl_t">
                <span class="zl_te1">
                    邮箱
                </span>
            </div>
            <div class="am-u-sm-8 am-text-right">
                <span class="zl_te useremail">
                    {{email}}
                </span>
                <span class="text-yz">未验证</span>
            </div>
        </div>
    </div>
</script>
<script src="js/xiangz.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
$.ajax({
    url: '/users/getInfo/',
    type: 'get',
    async: true,
    data: { _id: sessionStorage.uid },
    success: function(result) {
        if (result.status) {
            // data2.email = data2.email.replace(/(.{2}).+(.{2}@.+)/g, '$1****$2');
            var html = template("tpl-user", result.data);
            $("#infoBox").html(html);
        } else {
            alert(result.msg);
        }

    }
})
//表单验证
var showmsg = function(msg) {
    $("#tips").text(msg);
    $("#tips").css("opacity", "1");
    $("#tips").css("display", "block");
}
$("#form2").Validform({
    btnSubmit: "#bj2",
    //          tiptype: 1,
    tiptype: function(msg) {
        showmsg(msg);
    },

    ignoreHidden: false,
    dragonfly: false,
    tipSweep: true,
    label: ".label",
    showAllError: false,
    postonce: true,
    // ajaxPost: false,

    datatype: {
        "*6-20": /^[^\s]{3,30}$/,
        "z2-4": /^[\u4E00-\u9FA5\uf900-\ufa2d]{2,4}$/,
        "myphone": /^[1][3,4,5,7,8][0-9]{9}$/,
        "null": /^.{0}$/,
        "usercode": function(gets, obj, curform, regxp) {
            var res = verifyCode.validate(document.getElementById("usercode").value);
            if (res) {
                return true;
            } else {
                return "验证码错误"
            }
        },
    },
    usePlugin: {
        swfupload: {},
        datepicker: {},
        passwordstrength: {},
        jqtransform: {
            selector: "select,input"
        }
    },
    beforeCheck: function(curform) {
        //在表单提交执行验证之前执行的函数，curform参数是当前表单对象。
        //这里明确return false的话将不会继续执行验证操作;    
    },
    beforeSubmit: function(curform) {
        //在验证成功后，表单提交前执行的函数，curform参数是当前表单对象。
        //这里明确return false的话表单将不会提交;    
        //              location.href = "index.html";
        setTimeout(function() {
            $(".tilt1").css("display", "block");
            $(".tilt2").css("display", "none");
            $("#bj").css("display", "block");
            $uname = $(".username").eq(1).val();
            // $utel = $(".usertel").eq(1).val().replace(/(\d{3})\d{6}(\d{2})/, '$1******$2');
            $uemail = $(".useremail").eq(1).val().replace(/(.{2}).+(.{2}@.+)/g, '$1****$2');
            if ($uemail == '') {
                $("#infoBox .username").text($uname);
            } else {
                $("#infoBox .username").eq(0).text($uname + "(" + $uemail + ")");
            }
            // $("#infoBox .usertel").eq(0).text($utel);
            $("#infoBox .useremail").eq(0).text($uemail);
        }, 2000)
        var data = $("form").serialize();
        console.log(data)
        $.post('/users/xiugai/', data, function(data, textStatus, xhr) {
            if (!data.status) {
                alert(data.msg);
            }
        });
        return false;
    },
    callback: function(data) {
        //返回数据data是json对象，{"info":"demo info","status":"y"}
        //info: 输出提示信息;
        //status: 返回提交数据的状态,是否提交成功。如可以用"y"表示提交成功，"n"表示提交失败，在ajax_post.php文件返回数据里自定字符，主要用在callback函数里根据该值执行相应的回调操作;
        //你也可以在ajax_post.php文件返回更多信息在这里获取，进行相应操作；
        //ajax遇到服务端错误时也会执行回调，这时的data是{ status:**, statusText:**, readyState:**, responseText:** }；

        //这里执行回调操作;
        //注意：如果不是ajax方式提交表单，传入callback，这时data参数是当前表单对象，回调函数会在表单验证全部通过后执行，然后判断是否提交表单，如果callback里明确return false，则表单不会提交，如果return true或没有return，则会提交表单。
    }
});
</script>

</html>